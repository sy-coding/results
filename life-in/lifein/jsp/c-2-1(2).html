<!DOCTYPE html>
<html lang="ko-KR">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <title>생활보상서비스</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <!-- do not link // -->
    <meta name="format-detection" content="no" />
    <meta name="format-detection" content="telephone=no, address=no, email=no" />
    <!-- // do not link  -->

    <link rel="stylesheet" href="../styles/style_200407.min.css" />

    <!--[if lt IE 9]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
        <script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js" type="text/javascript"></script>
    <![endif]-->
    <!--[if lt IE 9]>
        <script type="text/javascript" src="//oss.maxcd.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script type="text/javascript" src="../scripts/lib/html5shiv.min.js"></script>
    <script type="text/javascript" src="../scripts/lib/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="../scripts/lib/slick.min.js"></script>
    <script type="text/javascript" src="../scripts/lib/howler.js"></script>
    <script type="text/javascript" src="../scripts/common.js"></script>
</head>
<body>
    <!-- header -->
    <header class="header-wrap sub">
        <h1 class="text"> 굿모닝팝스 학습하기</h1>
        <p class="header-right">
            <a href="#" class="btn-close"><span class="screen-out">닫기</span></a>
        </p>
    </header> 
    <!-- //header -->
    <!-- contents -->
    <div class="contents-wrap nobottom">
        <h2 class="screen-out">굿모닝팝스 학습 컨텐츠 상세</h2>

        <!-- 학습 컨텐츠 재생 bar // -->
        <section class="gmp-audio-wrap">
            <!-- Top Info -->
            <div id="title">
                <span id="track" class="display-none" aria-label="음원명"><span class="screen-out">음원명</span></span>
                <div id="timer" aria-label="음원 시작시간">00:00</div>
                <div id="duration" aria-label="음원 종료시간">33:33</div>
                <div id="rate" class="display-none" aria-label="속도조절"><span class="screen-out">속도조절</span></div>
            </div>

            <!-- Controls -->
            <div class="controlsOuter">
                <div class="controlsInner">
                    <div id="loading" aria-label="로딩중"><span class="screen-out">로딩중</span></div>
                    <div class="btn" id="playBtn" aria-label="재생하기"><span class="screen-out">재생하기</span></div>
                    <div class="btn" id="pauseBtn" aria-label="일시정지"><span class="screen-out">일시정지</span></div>
                    <div class="btn" id="prevBtn" aria-label="처음으로"><span class="screen-out">처음으로</span></div>
                    <div class="btn" id="nextBtn" aria-label="다음으로"><span class="screen-out">다음으로</span></div>
                    <div class="btn" id="seekPrevBtn" aria-label="15초 뒤로 가기"><span class="screen-out">15초 뒤로 가기</span></div>
                    <div class="btn" id="seekNextBtn" aria-label="15초 앞으로 가기"><span class="screen-out">15초 앞으로 가기</span></div>
                </div>
                <div class="btn" id="playlistBtn" aria-label="재생목록"><span class="screen-out">재생목록</span></div>
                <div class="btn" id="muteBtn" aria-label="음소거"><span class="screen-out">음소거</span></div>
                <div class="btn" id="volumeBtn" aria-label="음량조절"><span class="screen-out">음량조절</span></div>
                <div class="btn" id="spdUpBtn" aria-label="속도 빠르게"><span class="screen-out">속도 빠르게</span></div>
                <div class="btn" id="spdDnBtn" aria-label="속도 느리게"><span class="screen-out">속도 느리게</span></div>
            </div>

            <!-- Progress -->
            <!-- div id="waveform" ></div-->
            <div id="bar" aria-label="재생 bar"><span class="screen-out">재생 bar</span></div>
            <div id="progress" aria-label="진행중인 상태"><span class="screen-out">진행중인 상태</span></div>

            <!-- Playlist -->
            <div id="playlist" class="" aria-label="재생중인 목록">
                <div id="list"></div>
            </div>

            <!-- Volume -->
            <div id="volume" class="fadeout" aria-label="음량조절">
                <div id="barFull" class="bar" aria-label="제일 크게"><span class="screen-out">제일 크게</span></div>
                <div id="barEmpty" class="bar" aria-label="제일 낮게"><span class="screen-out">제일 낮게</span></div>
                <div id="sliderBtn"></div>
            </div>    
        </section>  
        <!-- // 학습 컨텐츠 재생 bar -->

        <!-- 굿모닝팝스 학습 컨텐츠(스크릡트) // -->
        <section class="gmp-study-wrap">

            <!-- 일자 및 탭 고정 -->
            <div class="gmp-study-toparea">             
                <!-- 일자 선택하기/캘린더 // -->
                <div class="gmp-study-daily">
                    <div class="study-indicator">
                        <a href="../jsp/c-2-1(1).html" class="prev" title="바로가기" role="button">
                            <span class="screen-out">이전</span>
                        </a>
                        <span class="today">2020. 7. 24 (금)</span>                
                        <a href="../jsp/c-2-1(3).html" class="next" title="바로가기" role="button">
                            <span class="screen-out">다음</span>
                        </a>
                    </div>
                    <a href="../jsp/c-2-1(5).html" class="study-calendar" title="바로가기" role="button">
                        <span class="screen-out">학습캘린더 보기</span>
                    </a>
                </div>
                <!-- // 일자 선택하기/캘린더 -->
            </div>

            <!-- 학습 컨텐츠(스크립트) 상세 // -->
            <div class="gmp-study-contents">

                <div class="weekend_scripts"><!-- 주말(금토일) 컨텐츠 -->
                    <dl>
                        <dt><span class="study_this">Friday News Pick</span> With Angela Park</dt>
                        <dd>전 세계 곳곳의 소식들을 통해서 시사 상식 공부하고 영어 표현까지 동시에 익혀보는 시간!</dd>
                    </dl> 
                    <dl>
                        <dt>Tube? Subway? <span class="study_this">Tube! Subway!</span></dt>
                        <dd>영국 출신 피터 빈트(Peter Bint)와 함께 재밌는 영국식 영어를 알아보는 시간!</dd>
                    </dl>
                    
                    <!-- 주말(금/토) 컨텐츠만 KBS 게시판에 업로드됨 -->
                    <a href="#" class="gotoKBSboard" target="_blank" title="새창열림">KBS 게시판 바로가기</a>

                    <!-- 월간 굿모닝팝스 출간정보 // -->
                    <div class="gmp-book-box weekend">
                        <div class="gmp-cover-img">
                            <img src="../images/gmp/gmp_mgz_cover/gmp_book_202007.png" alt="">
                        </div>                    
                        <div class="gmp-book-info">
                            <h2 class="title">월간 <span class="color-lifein1">굿모닝팝스</span></h2>
                            <p>
                                <span class="gmp_month_date">2020년 7월호</span>
                                <span class="gmp_publisher">한국방송출판 저</span>
                            </p>
                        </div>
                    </div>
                    <!-- // 월간 굿모닝팝스 출간정보 -->                    
                </div>

            </div>
            <!-- // 학습 컨텐츠(스크립트) 상세 -->

        </section>
        <!-- // 굿모닝팝스 학습 컨텐츠(스크릡트) -->
    </div>
    <!-- //contents -->

    <script>
        $(function($){
            var elms = ['track', 'timer', 'duration', 'playBtn', 'pauseBtn', 'prevBtn', 'nextBtn','seekPrevBtn','seekNextBtn', 'playlistBtn', 'muteBtn','volumeBtn', 'progress', 'bar', 'wave', 'loading', 'playlist', 'list', 'volume', 'barEmpty', 'barFull', 'sliderBtn', 'spdUpBtn', 'spdDnBtn'];
            elms.forEach(function(elm) {
              window[elm] = document.getElementById(elm);
            });
            var self = this;
            var sound;
            var utils = {
                formatTime: function (secs) {
                    var minutes = Math.floor(secs / 60) || 0;
                    var seconds = (secs - minutes * 60) || 0;
                    return minutes + ':' + (seconds < 10 ? '0' : '') + seconds;
                },
                updateTimeTracker: function () {
                    var self = this;
                    var seek = sound.seek() || 0;
                    var currentTime = utils.formatTime(Math.round(seek));
        
                    $('#timer').text(currentTime);
                    progress.style.width = (((seek / self.duration()) * 100) || 0) + '%';
                    
                    if (self.playing()) {
                        requestAnimationFrame(utils.updateTimeTracker.bind(self));
                    }
                },
                seekSeconds: function(sec) {
                    console.log("seekSeconds : " + sec);
                    var seekSec = sound.seek() || 0;
                    console.log("currentSeconds : " + Math.round(seekSec));
                    var seconds = Math.round(seekSec)+sec;
                    
                    if (sound.playing()) {
                        //뒤로 10초
                        if(sec < 0){
                             if(Math.round(seekSec) <= 10){
                              sound.seek(0);
                             }else{
                                 console.log("backSeconds : " + seconds);
                                 sound.seek(seconds);
                             }
                        }
                        //앞으로 10초
                        else{
                            console.log("toSeconds : " + seconds);
                            sound.seek(seconds);
                        }
                        sound.play();
                    }
                },
                play : function(soundSrc) {
                    sound = new Howl({
                        src:[soundSrc],
                        html5: true, // Force to HTML5 so that the audio can stream in (best for large files).
                        format:['mp3'],
                        onplay: function() {
                            var time = Math.round(sound.duration());
                            $('#duration').html(utils.formatTime(time));
                            requestAnimationFrame(utils.updateTimeTracker.bind(this));
                            
                            playBtn.style.display = 'none';
                            pauseBtn.style.display = 'block';
                        },
                        onpause : function() {
                            pauseBtn.style.display = 'none';
                            playBtn.style.display = 'block';
                        },
                        onplayerror : function() {
                            sound.once('unlock', function(){
                                sound.play();
                            })
                        }
                    });
                },
                getGmpContent : function(paramDay) {
                    $.ajax({
                        url: "/lifein/gmp/getGmpContents",
                        dataType : "json",
                        type : "post",
                        async : true,
                        data : {day: paramDay},
                        success : function(data) {
                            //console.log("getGmpContent : "+data);
                            //$('#gmp_contents').html(data.data.contents);
                            $('#gmp_screen_contents').html(data.data.contents);
                            //$('#'+obj).html(data.data.combo);
                        },
                        error : function() {
                            //alert('실패');
                        }		
                    });
                }
            };
            //var isMute = false;
        
            //seekPrevBtn.style.display = 'none';
            //seekNextBtn.style.display = 'none';	
            /*  기능 보류
            var wave = new SiriWave({
                  container: waveform,
                  width: window.innerWidth,
                  height: window.innerHeight * 0.3,
                  cover: false,
                  speed: 0.03,
                  amplitude: 0.7,
                  frequency: 2
                });
             */
            utils.getGmpContent('20190528');
            utils.play('https://lifein-test.vpay.co.kr/test/I0000-2014_S000_20200330_PI-1585530876-24-8AA_00_00_99_M3A30012.mp3');
            //utils.play('http://down.kbs.gscdn.com/KBS_CMS_DOWN/R2018-0085/R2018-0085_S000_20190528_PS-2019087439-01-000_03_M3A30012.mp3');
        
            
            $('#playBtn').unbind("click").on('click', function(){
                sound.play();
            });
            $('#pauseBtn').unbind("click").on('click', function(){
                sound.pause();
            });
            $('#prevBtn').unbind("click").on('click', function(){
                sound.skip('prev');
            });
            $('#nextBtn').unbind("click").on('click', function(){
                utils.sound.skip('next');
            });
            $('#seekPrevBtn').unbind("click").on('click', function(){
                utils.seekSeconds(-15);
            });
            $('#seekNextBtn').unbind("click").on('click', function(){
                utils.seekSeconds(15);
            });
            $('#bar').unbind("click").on('click', function(){
                sound.seek(event.clientX / window.innerWidth *sound.duration());
                sound.play();
            });
            
        });
        </script>    
</body>
</html>